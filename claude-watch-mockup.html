<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claude Watch â€“ Watch & Phone Mockup</title>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: system-ui, -apple-system, sans-serif;
    background: #111;
    color: #ddd;
    display: flex;
    height: 100vh;
    overflow: hidden;
  }

  /* Layout */
  .controls-panel {
    width: 320px;
    min-width: 280px;
    background: #1a1a1a;
    border-right: 1px solid #333;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
    padding: 20px;
  }

  .preview-area {
    flex: 1;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: center;
    gap: 60px;
    background: #0d0d0d;
  }

  .prompt-output {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: #1a1a1a;
    border-top: 1px solid #333;
    padding: 12px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 100;
  }

  .prompt-output pre {
    flex: 1;
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 12px;
    color: #aaa;
    white-space: pre-wrap;
    max-height: 80px;
    overflow-y: auto;
  }

  .copy-btn {
    background: #333;
    color: #ddd;
    border: 1px solid #555;
    padding: 6px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    white-space: nowrap;
  }
  .copy-btn:hover { background: #444; }

  /* Controls */
  h2 {
    font-size: 11px;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: #666;
    margin-top: 20px;
    margin-bottom: 8px;
  }
  h2:first-child { margin-top: 0; }

  .control-group {
    margin-bottom: 6px;
  }

  .control-group label {
    display: block;
    font-size: 12px;
    color: #999;
    margin-bottom: 4px;
  }

  .btn-row {
    display: flex;
    gap: 4px;
    flex-wrap: wrap;
  }

  .btn-row button {
    padding: 6px 10px;
    font-size: 11px;
    border: 1px solid #444;
    border-radius: 6px;
    background: #222;
    color: #ccc;
    cursor: pointer;
    transition: all 0.15s;
  }
  .btn-row button:hover { border-color: #0099FF; color: #fff; }
  .btn-row button.active {
    background: #0099FF;
    border-color: #0099FF;
    color: #fff;
  }

  .action-btn {
    width: 100%;
    padding: 8px;
    font-size: 12px;
    border: 1px solid #444;
    border-radius: 6px;
    background: #222;
    color: #ccc;
    cursor: pointer;
    margin-bottom: 4px;
  }
  .action-btn:hover { border-color: #0099FF; color: #fff; }

  .preset-btn {
    padding: 6px 12px;
    font-size: 11px;
    border: 1px solid #F59E0B;
    border-radius: 6px;
    background: transparent;
    color: #F59E0B;
    cursor: pointer;
  }
  .preset-btn:hover { background: #F59E0B22; }

  /* Watch */
  .watch-container {
    position: relative;
    margin-bottom: 60px;
  }

  .watch-bezel {
    width: 340px;
    height: 340px;
    border-radius: 50%;
    background: linear-gradient(135deg, #333, #1a1a1a, #333);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 32px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.05);
  }

  .watch-screen {
    width: 300px;
    height: 300px;
    border-radius: 50%;
    background: #000;
    position: relative;
    overflow: hidden;
    display: flex;
    flex-direction: column;
  }

  /* Connection bar */
  .conn-bar {
    width: 100%;
    height: 4px;
    transition: background 0.3s;
    flex-shrink: 0;
    z-index: 10;
  }
  .conn-bar.connected { background: #4CAF50; }
  .conn-bar.connecting { background: #F59E0B; }
  .conn-bar.disconnected { background: #F44336; }

  /* Settings gear */
  .settings-icon {
    position: absolute;
    top: 28px;
    right: 36px;
    width: 18px;
    height: 18px;
    color: #666;
    z-index: 5;
    cursor: default;
  }

  /* Chat area */
  .chat-area {
    flex: 1;
    overflow-y: auto;
    padding: 32px 24px 56px 24px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .chat-area::-webkit-scrollbar { display: none; }

  .chat-msg {
    max-width: 80%;
    padding: 6px 10px;
    border-radius: 12px;
    font-size: 11px;
    line-height: 1.3;
    word-wrap: break-word;
    animation: msgIn 0.25s ease-out;
  }

  @keyframes msgIn {
    from { opacity: 0; transform: translateY(8px) scale(0.95); }
    to { opacity: 1; transform: translateY(0) scale(1); }
  }

  .chat-msg.user {
    align-self: flex-end;
    background: #1565C0;
    color: #fff;
    border-bottom-right-radius: 4px;
  }

  .chat-msg.claude {
    align-self: flex-start;
    background: #222;
    color: #ccc;
    border-bottom-left-radius: 4px;
  }

  .chat-msg .msg-label {
    font-size: 8px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    color: #888;
    margin-bottom: 2px;
  }

  /* Thinking dots */
  .thinking-dots {
    display: flex;
    gap: 4px;
    padding: 4px 0;
  }
  .thinking-dots span {
    width: 6px;
    height: 6px;
    background: #666;
    border-radius: 50%;
    animation: pulse 1.2s infinite;
  }
  .thinking-dots span:nth-child(2) { animation-delay: 0.2s; }
  .thinking-dots span:nth-child(3) { animation-delay: 0.4s; }

  @keyframes pulse {
    0%, 80%, 100% { opacity: 0.3; transform: scale(0.8); }
    40% { opacity: 1; transform: scale(1.1); }
  }

  /* Bottom controls */
  .watch-bottom {
    position: absolute;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    align-items: center;
    gap: 8px;
    z-index: 10;
  }

  .rec-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    font-size: 10px;
    font-weight: bold;
    color: #fff;
    cursor: default;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.25s;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }

  .rec-btn.idle { background: #1565C0; }
  .rec-btn.recording { background: #C62828; animation: recPulse 1s infinite; }
  .rec-btn.thinking { display: none; }
  .rec-btn.speaking { display: none; }

  @keyframes recPulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(198, 40, 40, 0.5); }
    50% { box-shadow: 0 0 0 8px rgba(198, 40, 40, 0); }
  }

  .abort-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: #E65100;
    font-size: 10px;
    font-weight: bold;
    color: #fff;
    cursor: default;
    display: none;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }
  .abort-btn.visible { display: flex; }

  .audio-controls {
    display: none;
    gap: 8px;
    align-items: center;
  }
  .audio-controls.visible { display: flex; }

  .audio-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: none;
    font-size: 9px;
    font-weight: bold;
    color: #fff;
    cursor: default;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }
  .audio-btn.replay { background: #2E7D32; }
  .audio-btn.pause { background: #1565C0; }

  .done-btn {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    border: none;
    background: #2E7D32;
    font-size: 10px;
    font-weight: bold;
    color: #fff;
    cursor: default;
    display: none;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
  }

  /* Progress spinner overlay */
  .progress-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.45);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 8;
  }
  .progress-overlay.visible { display: flex; }
  .progress-overlay svg { animation: spin 1.2s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Permission overlay */
  .perm-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: rgba(0,0,0,0.87);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 50px 30px 40px;
    z-index: 20;
    animation: fadeIn 0.2s;
  }
  .perm-overlay.visible { display: flex; }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  .perm-title {
    font-size: 12px;
    font-weight: bold;
    color: #FFB74D;
    margin-bottom: 4px;
  }

  .perm-context {
    font-size: 9px;
    color: #888;
    text-align: center;
    margin-bottom: 4px;
    max-height: 24px;
    overflow: hidden;
  }

  .perm-question {
    font-size: 11px;
    color: #fff;
    text-align: center;
    margin-bottom: 10px;
    line-height: 1.3;
  }

  .perm-buttons {
    display: flex;
    flex-direction: column;
    gap: 6px;
    width: 100%;
  }

  .perm-btn {
    width: 100%;
    padding: 8px 12px;
    border: none;
    border-radius: 20px;
    font-size: 10px;
    font-weight: bold;
    color: #fff;
    cursor: default;
  }
  .perm-btn.allow { background: #4CAF50; }
  .perm-btn.deny { background: #F44336; }
  .perm-btn.always { background: #2962FF; }

  /* State badge */
  .state-badge {
    position: absolute;
    top: 28px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 2px 8px;
    border-radius: 8px;
    z-index: 5;
  }
  .state-badge.idle { color: #666; background: #1a1a1a; }
  .state-badge.listening { color: #F44336; background: #1a1a1a; }
  .state-badge.thinking { color: #F59E0B; background: #1a1a1a; }
  .state-badge.speaking { color: #4CAF50; background: #1a1a1a; }

  /* Empty state */
  .empty-state {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #444;
    font-size: 12px;
    text-align: center;
    padding: 40px;
    line-height: 1.5;
  }

  /* ===== Phone Mockup ===== */
  .phone-container {
    position: relative;
    margin-bottom: 60px;
  }

  .phone-frame {
    width: 260px;
    height: 520px;
    border-radius: 28px;
    background: #1a1a2e;
    border: 2px solid #333;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.6);
    position: relative;
  }

  /* Phone status bar */
  .phone-statusbar {
    height: 24px;
    background: #252542;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  .phone-statusbar span {
    font-size: 10px;
    color: #888;
  }

  /* Phone header */
  .phone-header {
    height: 40px;
    background: #252542;
    display: flex;
    align-items: center;
    padding: 0 12px;
    gap: 8px;
    flex-shrink: 0;
  }
  .phone-conn-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    transition: background 0.3s;
  }
  .phone-conn-dot.connected { background: #4CAF50; }
  .phone-conn-dot.connecting { background: #F59E0B; }
  .phone-conn-dot.disconnected { background: #F44336; }
  .phone-conn-label {
    font-size: 12px;
    color: #fff;
  }
  .phone-settings-icon {
    margin-left: auto;
    color: #888;
    font-size: 16px;
  }

  /* Creature area */
  .creature-area {
    height: 170px;
    background: #1a1a2e;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    position: relative;
  }

  .creature-svg {
    width: 160px;
    height: 160px;
  }

  .creature-divider {
    height: 1px;
    background: #252542;
    flex-shrink: 0;
  }

  /* Phone chat */
  .phone-chat {
    flex: 1;
    overflow-y: auto;
    padding: 10px 12px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    background: #1a1a2e;
  }
  .phone-chat::-webkit-scrollbar { display: none; }

  .phone-msg {
    max-width: 82%;
    padding: 8px 12px;
    border-radius: 16px;
    font-size: 12px;
    line-height: 1.35;
    word-wrap: break-word;
    animation: msgIn 0.25s ease-out;
  }
  .phone-msg.user {
    align-self: flex-end;
    background: linear-gradient(90deg, #0099FF, #0077CC);
    color: #fff;
    border-bottom-right-radius: 4px;
  }
  .phone-msg.claude {
    align-self: flex-start;
    background: #F59E0B;
    color: #1a1a2e;
    border-bottom-left-radius: 4px;
  }
  .phone-msg .msg-label {
    font-size: 8px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 2px;
  }
  .phone-msg.user .msg-label { color: rgba(255,255,255,0.6); }
  .phone-msg.claude .msg-label { color: rgba(26,26,46,0.5); }

  .phone-empty {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #444;
    font-size: 12px;
    text-align: center;
  }

  /* Phone thinking dots */
  .phone-thinking {
    display: flex;
    gap: 4px;
    padding: 4px 0;
  }
  .phone-thinking span {
    width: 6px;
    height: 6px;
    background: rgba(26,26,46,0.4);
    border-radius: 50%;
    animation: pulse 1.2s infinite;
  }
  .phone-thinking span:nth-child(2) { animation-delay: 0.2s; }
  .phone-thinking span:nth-child(3) { animation-delay: 0.4s; }

  /* Phone input bar */
  .phone-inputbar {
    height: 52px;
    background: #252542;
    display: flex;
    align-items: center;
    padding: 0 8px;
    gap: 8px;
    flex-shrink: 0;
  }

  .phone-voice-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #0099FF;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    cursor: default;
  }
  .phone-voice-btn svg {
    width: 16px;
    height: 16px;
    fill: white;
  }

  .phone-text-input {
    flex: 1;
    height: 32px;
    border-radius: 16px;
    background: rgba(255,255,255,0.1);
    display: flex;
    align-items: center;
    padding: 0 14px;
    font-size: 11px;
    color: #666;
  }

  .phone-send-btn {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: #F59E0B;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    cursor: default;
  }
  .phone-send-btn svg {
    width: 16px;
    height: 16px;
    fill: white;
  }

  /* Phone permission overlay */
  .phone-perm-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 40px 24px;
    z-index: 20;
    animation: fadeIn 0.2s;
    border-radius: 28px;
  }
  .phone-perm-overlay.visible { display: flex; }

  .phone-perm-card {
    background: #252542;
    border-radius: 16px;
    padding: 20px;
    width: 100%;
    max-width: 220px;
  }
  .phone-perm-card .perm-title {
    font-size: 14px;
    font-weight: bold;
    color: #FFB74D;
    margin-bottom: 6px;
  }
  .phone-perm-card .perm-context {
    font-size: 10px;
    color: #888;
    margin-bottom: 4px;
    text-align: left;
    max-height: none;
  }
  .phone-perm-card .perm-question {
    font-size: 12px;
    color: #fff;
    text-align: left;
    margin-bottom: 14px;
    font-family: 'SF Mono', 'Fira Code', monospace;
    background: #1a1a2e;
    padding: 8px 10px;
    border-radius: 8px;
    word-break: break-all;
  }
  .phone-perm-card .perm-buttons {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .phone-perm-card .perm-btn {
    padding: 10px;
    border-radius: 10px;
    text-align: center;
    font-size: 12px;
    font-weight: bold;
    color: #fff;
    cursor: default;
  }

  /* Creature emotions */
  .creature-area[data-emotion="happy"] .creature-mouth-happy { display: block; }
  .creature-area[data-emotion="happy"] .creature-mouth-thinking { display: none; }
  .creature-area[data-emotion="thinking"] .creature-mouth-happy { display: none; }
  .creature-area[data-emotion="thinking"] .creature-mouth-thinking { display: block; }

  /* Device labels */
  .device-label {
    text-align: center;
    font-size: 11px;
    color: #555;
    margin-top: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
</style>
</head>
<body>

<div class="controls-panel">
  <h2>Presets</h2>
  <div class="btn-row" style="margin-bottom:10px">
    <button class="preset-btn" onclick="applyPreset('idle')">Idle</button>
    <button class="preset-btn" onclick="applyPreset('recording')">Recording</button>
    <button class="preset-btn" onclick="applyPreset('thinking')">Thinking</button>
    <button class="preset-btn" onclick="applyPreset('speaking')">Speaking</button>
    <button class="preset-btn" onclick="applyPreset('permission')">Permission</button>
  </div>

  <h2>State</h2>
  <div class="control-group">
    <label>Claude State</label>
    <div class="btn-row" id="stateButtons">
      <button class="active" data-state="idle" onclick="setState('idle')">Idle</button>
      <button data-state="listening" onclick="setState('listening')">Listening</button>
      <button data-state="thinking" onclick="setState('thinking')">Thinking</button>
      <button data-state="speaking" onclick="setState('speaking')">Speaking</button>
    </div>
  </div>

  <div class="control-group">
    <label>Connection</label>
    <div class="btn-row" id="connButtons">
      <button class="active" data-conn="connected" onclick="setConnection('connected')">Connected</button>
      <button data-conn="connecting" onclick="setConnection('connecting')">Connecting</button>
      <button data-conn="disconnected" onclick="setConnection('disconnected')">Disconnected</button>
    </div>
  </div>

  <h2>Chat Messages</h2>
  <button class="action-btn" onclick="addUserMessage()">+ User Message</button>
  <button class="action-btn" onclick="addClaudeMessage()">+ Claude Response</button>
  <button class="action-btn" onclick="addConversation()">+ Full Conversation</button>
  <button class="action-btn" onclick="clearMessages()">Clear Messages</button>

  <h2>Permission Prompt</h2>
  <div class="control-group">
    <label>Trigger Overlay</label>
    <button class="action-btn" onclick="showPermission('bash')">Bash Command</button>
    <button class="action-btn" onclick="showPermission('write')">File Write</button>
    <button class="action-btn" onclick="showPermission('edit')">File Edit</button>
    <button class="action-btn" onclick="hidePermission()">Dismiss</button>
  </div>

  <h2>Sample Scenarios</h2>
  <button class="action-btn" onclick="scenario('voice')">Voice Query Flow</button>
  <button class="action-btn" onclick="scenario('permission')">Permission Request Flow</button>
  <button class="action-btn" onclick="scenario('multi')">Multi-turn Chat</button>
</div>

<div class="preview-area">
  <div class="watch-container">
    <div class="watch-bezel">
      <div class="watch-screen" id="watchScreen">
        <!-- Connection bar -->
        <div class="conn-bar connected" id="connBar"></div>

        <!-- State badge -->
        <div class="state-badge idle" id="stateBadge">idle</div>

        <!-- Settings icon -->
        <svg class="settings-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.14,12.94c.04-.31.06-.63.06-.94s-.02-.63-.06-.94l2.03-1.58a.49.49,0,0,0,.12-.61l-1.92-3.32a.49.49,0,0,0-.59-.22l-2.39.96a7.04,7.04,0,0,0-1.62-.94l-.36-2.54a.48.48,0,0,0-.48-.41h-3.84a.48.48,0,0,0-.48.41l-.36,2.54a7.04,7.04,0,0,0-1.62.94l-2.39-.96a.49.49,0,0,0-.59.22L2.74,8.87a.48.48,0,0,0,.12.61l2.03,1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03,1.58a.49.49,0,0,0-.12.61l1.92,3.32a.49.49,0,0,0,.59.22l2.39-.96c.5.38,1.04.7,1.62.94l.36,2.54a.48.48,0,0,0,.48.41h3.84a.48.48,0,0,0,.48-.41l.36-2.54a7.04,7.04,0,0,0,1.62-.94l2.39.96a.49.49,0,0,0,.59-.22l1.92-3.32a.49.49,0,0,0-.12-.61ZM12,15.6A3.6,3.6,0,1,1,15.6,12,3.6,3.6,0,0,1,12,15.6Z"/>
        </svg>

        <!-- Chat area -->
        <div class="chat-area" id="chatArea">
          <div class="empty-state" id="emptyState">Tap Record to<br>talk to Claude</div>
        </div>

        <!-- Progress overlay -->
        <div class="progress-overlay" id="progressOverlay">
          <svg width="48" height="48" viewBox="0 0 48 48">
            <circle cx="24" cy="24" r="18" fill="none" stroke="#42A5F5" stroke-width="3" stroke-dasharray="80 34" stroke-linecap="round"/>
          </svg>
        </div>

        <!-- Bottom controls -->
        <div class="watch-bottom" id="watchBottom">
          <div class="rec-btn idle" id="recBtn">Rec</div>
          <div class="abort-btn" id="abortBtn">Stop</div>
          <div class="audio-controls" id="audioCtrl">
            <div class="audio-btn replay">Re</div>
            <div class="audio-btn pause">Pause</div>
          </div>
          <div class="done-btn" id="doneBtn">Done</div>
        </div>

        <!-- Permission overlay -->
        <div class="perm-overlay" id="permOverlay">
          <div class="perm-title" id="permTitle">Permission</div>
          <div class="perm-context" id="permContext"></div>
          <div class="perm-question" id="permQuestion">Allow action?</div>
          <div class="perm-buttons" id="permButtons"></div>
        </div>
      </div>
    </div>
    <div class="device-label">Galaxy Watch</div>
  </div>

  <!-- Phone Mockup -->
  <div class="phone-container">
    <div class="phone-frame" id="phoneFrame">
      <!-- Status bar -->
      <div class="phone-statusbar"><span>9:41</span></div>

      <!-- Header -->
      <div class="phone-header">
        <div class="phone-conn-dot connected" id="phoneConnDot"></div>
        <span class="phone-conn-label" id="phoneConnLabel">Connected</span>
        <span class="phone-settings-icon">&#9881;</span>
      </div>

      <!-- Creature area -->
      <div class="creature-area" id="creatureArea" data-emotion="happy">
        <svg class="creature-svg" viewBox="0 0 160 160">
          <!-- Body -->
          <defs>
            <radialGradient id="cGrad" cx="50%" cy="30%" r="70%">
              <stop offset="30%" stop-color="#FBBF24"/>
              <stop offset="100%" stop-color="#D97706"/>
            </radialGradient>
          </defs>
          <ellipse cx="80" cy="90" rx="50" ry="55" fill="url(#cGrad)"/>
          <!-- Ears -->
          <circle cx="42" cy="45" r="14" fill="url(#cGrad)"/>
          <circle cx="118" cy="45" r="14" fill="url(#cGrad)"/>
          <!-- Eyes -->
          <ellipse cx="62" cy="82" rx="12" ry="13" fill="white"/>
          <ellipse cx="98" cy="82" rx="12" ry="13" fill="white"/>
          <circle cx="62" cy="84" r="7" fill="black"/>
          <circle cx="98" cy="84" r="7" fill="black"/>
          <circle cx="64" cy="80" r="3" fill="white"/>
          <circle cx="100" cy="80" r="3" fill="white"/>
          <!-- Mouth: happy -->
          <path class="creature-mouth-happy" d="M 62 112 Q 80 130 98 112" stroke="black" stroke-width="3" fill="none" stroke-linecap="round"/>
          <!-- Mouth: thinking (small o) -->
          <ellipse class="creature-mouth-thinking" cx="80" cy="115" rx="6" ry="8" fill="black" style="display:none"/>
        </svg>
      </div>

      <div class="creature-divider"></div>

      <!-- Chat -->
      <div class="phone-chat" id="phoneChatArea">
        <div class="phone-empty" id="phoneEmpty">Send a message or<br>use your voice</div>
      </div>

      <!-- Input bar -->
      <div class="phone-inputbar">
        <div class="phone-voice-btn">
          <svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5zm6 6c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg>
        </div>
        <div class="phone-text-input">Type a message...</div>
        <div class="phone-send-btn">
          <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </div>
      </div>

      <!-- Permission overlay -->
      <div class="phone-perm-overlay" id="phonePermOverlay">
        <div class="phone-perm-card">
          <div class="perm-title" id="phonePermTitle">Permission</div>
          <div class="perm-context" id="phonePermContext">Tool: Bash</div>
          <div class="perm-question" id="phonePermQuestion">rm -rf /tmp/cache/*.tmp</div>
          <div class="perm-buttons" id="phonePermButtons"></div>
        </div>
      </div>
    </div>
    <div class="device-label">Companion Phone</div>
  </div>
</div>

<div class="prompt-output">
  <pre id="promptText">Wear OS watch mockup: round 300px face, black background, idle state, connected.</pre>
  <button class="copy-btn" id="copyBtn" onclick="copyPrompt()">Copy</button>
</div>

<script>
  // ---- State ----
  const DEFAULTS = {
    claudeState: 'idle',
    connection: 'connected',
    permissionVisible: false,
    permissionType: null,
    messages: []
  };

  const state = { ...DEFAULTS, messages: [] };

  const sampleUserMessages = [
    "List files in src/",
    "Fix the login bug",
    "What does server.py do?",
    "Run the tests",
    "Refactor the auth module",
    "Show me the logs"
  ];

  const sampleClaudeMessages = [
    "I found 12 files in src/. The main entry point is server.py which handles HTTP and WebSocket connections.",
    "The login bug was caused by a missing null check on line 42. I've fixed it.",
    "Done! All 8 tests pass.",
    "I'll read the file and analyze it for you.",
    "The server module handles incoming requests on port 5566 and WebSocket on 5567.",
    "I've refactored the auth module into three separate concerns: validation, session management, and token handling."
  ];

  let userMsgIdx = 0;
  let claudeMsgIdx = 0;

  // ---- Controls ----
  function setState(s) {
    state.claudeState = s;
    document.querySelectorAll('#stateButtons button').forEach(b => {
      b.classList.toggle('active', b.dataset.state === s);
    });
    updateAll();
  }

  function setConnection(c) {
    state.connection = c;
    document.querySelectorAll('#connButtons button').forEach(b => {
      b.classList.toggle('active', b.dataset.conn === c);
    });
    updateAll();
  }

  function addUserMessage() {
    const msg = sampleUserMessages[userMsgIdx % sampleUserMessages.length];
    userMsgIdx++;
    state.messages.push({ role: 'user', text: msg });
    updateAll();
  }

  function addClaudeMessage() {
    const msg = sampleClaudeMessages[claudeMsgIdx % sampleClaudeMessages.length];
    claudeMsgIdx++;
    state.messages.push({ role: 'claude', text: msg });
    updateAll();
  }

  function addConversation() {
    state.messages.push(
      { role: 'user', text: sampleUserMessages[userMsgIdx % sampleUserMessages.length] }
    );
    userMsgIdx++;
    state.messages.push(
      { role: 'claude', text: sampleClaudeMessages[claudeMsgIdx % sampleClaudeMessages.length] }
    );
    claudeMsgIdx++;
    updateAll();
  }

  function clearMessages() {
    state.messages = [];
    userMsgIdx = 0;
    claudeMsgIdx = 0;
    updateAll();
  }

  function showPermission(type) {
    state.permissionVisible = true;
    state.permissionType = type;
    updateAll();
  }

  function hidePermission() {
    state.permissionVisible = false;
    state.permissionType = null;
    updateAll();
  }

  // ---- Presets ----
  function applyPreset(name) {
    switch(name) {
      case 'idle':
        state.claudeState = 'idle';
        state.connection = 'connected';
        state.permissionVisible = false;
        state.messages = [];
        userMsgIdx = 0; claudeMsgIdx = 0;
        break;
      case 'recording':
        state.claudeState = 'listening';
        state.connection = 'connected';
        state.permissionVisible = false;
        if (state.messages.length === 0) {
          state.messages = [
            { role: 'user', text: 'Fix the login bug' },
            { role: 'claude', text: 'The login bug was caused by a missing null check on line 42. I\'ve fixed it.' }
          ];
        }
        break;
      case 'thinking':
        state.claudeState = 'thinking';
        state.connection = 'connected';
        state.permissionVisible = false;
        state.messages = [
          { role: 'user', text: 'Refactor the auth module' },
          { role: 'claude', text: 'I\'ll analyze the current structure and propose changes.' },
          { role: 'user', text: 'Go ahead and do it' }
        ];
        break;
      case 'speaking':
        state.claudeState = 'speaking';
        state.connection = 'connected';
        state.permissionVisible = false;
        state.messages = [
          { role: 'user', text: 'What does server.py do?' },
          { role: 'claude', text: 'The server module handles HTTP requests on port 5566 and WebSocket connections on port 5567. It manages audio transcription, chat history, and permission prompts.' }
        ];
        break;
      case 'permission':
        state.claudeState = 'thinking';
        state.connection = 'connected';
        state.permissionVisible = true;
        state.permissionType = 'bash';
        state.messages = [
          { role: 'user', text: 'Run the tests' }
        ];
        break;
    }
    // Sync control buttons
    document.querySelectorAll('#stateButtons button').forEach(b =>
      b.classList.toggle('active', b.dataset.state === state.claudeState));
    document.querySelectorAll('#connButtons button').forEach(b =>
      b.classList.toggle('active', b.dataset.conn === state.connection));
    updateAll();
  }

  // ---- Scenarios ----
  function scenario(name) {
    clearMessages();
    switch(name) {
      case 'voice':
        state.messages = [
          { role: 'user', text: 'List files in src/' },
          { role: 'claude', text: 'I found 12 files in src/. The main entry point is server.py.' }
        ];
        state.claudeState = 'idle';
        state.connection = 'connected';
        break;
      case 'permission':
        state.messages = [
          { role: 'user', text: 'Delete all temp files' }
        ];
        state.claudeState = 'thinking';
        state.connection = 'connected';
        state.permissionVisible = true;
        state.permissionType = 'bash';
        break;
      case 'multi':
        state.messages = [
          { role: 'user', text: 'What does server.py do?' },
          { role: 'claude', text: 'It\'s the main HTTP + WebSocket server handling audio, chat, and permissions.' },
          { role: 'user', text: 'Show me the endpoints' },
          { role: 'claude', text: 'POST /transcribe, GET /api/chat, POST /api/message, POST /api/permission/respond, and more.' },
          { role: 'user', text: 'Add a health check endpoint' },
          { role: 'claude', text: 'Done! Added GET /api/health returning {status: "ok"}.' }
        ];
        state.claudeState = 'idle';
        state.connection = 'connected';
        break;
    }
    document.querySelectorAll('#stateButtons button').forEach(b =>
      b.classList.toggle('active', b.dataset.state === state.claudeState));
    document.querySelectorAll('#connButtons button').forEach(b =>
      b.classList.toggle('active', b.dataset.conn === state.connection));
    updateAll();
  }

  // ---- Render ----
  function updateAll() {
    renderWatch();
    renderPhone();
    updatePrompt();
  }

  function renderPhone() {
    // Connection
    const dot = document.getElementById('phoneConnDot');
    const label = document.getElementById('phoneConnLabel');
    dot.className = 'phone-conn-dot ' + state.connection;
    const connLabels = { connected: 'Connected', connecting: 'Connecting...', disconnected: 'Disconnected' };
    label.textContent = connLabels[state.connection];

    // Creature emotion
    const creatureArea = document.getElementById('creatureArea');
    const happyMouth = creatureArea.querySelector('.creature-mouth-happy');
    const thinkMouth = creatureArea.querySelector('.creature-mouth-thinking');
    if (state.claudeState === 'thinking') {
      happyMouth.style.display = 'none';
      thinkMouth.style.display = 'block';
    } else {
      happyMouth.style.display = 'block';
      thinkMouth.style.display = 'none';
    }

    // Chat
    const chatArea = document.getElementById('phoneChatArea');
    const empty = document.getElementById('phoneEmpty');
    chatArea.querySelectorAll('.phone-msg, .phone-thinking-wrap').forEach(el => el.remove());

    if (state.messages.length === 0) {
      empty.style.display = 'flex';
    } else {
      empty.style.display = 'none';
      state.messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'phone-msg ' + msg.role;
        const lbl = document.createElement('div');
        lbl.className = 'msg-label';
        lbl.textContent = msg.role === 'user' ? 'You' : 'Claude';
        div.appendChild(lbl);
        const txt = document.createElement('div');
        txt.textContent = msg.text;
        div.appendChild(txt);
        chatArea.appendChild(div);
      });

      if (state.claudeState === 'thinking') {
        const wrap = document.createElement('div');
        wrap.className = 'phone-msg claude phone-thinking-wrap';
        wrap.innerHTML = '<div class="phone-thinking"><span></span><span></span><span></span></div>';
        chatArea.appendChild(wrap);
      }

      chatArea.scrollTop = chatArea.scrollHeight;
    }

    // Permission
    const permOverlay = document.getElementById('phonePermOverlay');
    if (state.permissionVisible) {
      permOverlay.classList.add('visible');
      renderPhonePermission();
    } else {
      permOverlay.classList.remove('visible');
    }
  }

  function renderPhonePermission() {
    const title = document.getElementById('phonePermTitle');
    const context = document.getElementById('phonePermContext');
    const question = document.getElementById('phonePermQuestion');
    const buttons = document.getElementById('phonePermButtons');

    const perms = {
      bash: { title: 'Permission Required', context: 'Tool: Bash', question: 'rm -rf /tmp/cache/*.tmp',
        buttons: [{ text: 'Allow', class: 'allow' }, { text: 'Allow Always', class: 'always' }, { text: 'Deny', class: 'deny' }] },
      write: { title: 'Permission Required', context: 'Tool: Write', question: 'Create file: src/health.py',
        buttons: [{ text: 'Allow', class: 'allow' }, { text: 'Deny', class: 'deny' }] },
      edit: { title: 'Permission Required', context: 'Tool: Edit', question: 'Edit server.py lines 42-58',
        buttons: [{ text: 'Allow', class: 'allow' }, { text: 'Allow Always', class: 'always' }, { text: 'Deny', class: 'deny' }] }
    };

    const p = perms[state.permissionType] || perms.bash;
    title.textContent = p.title;
    context.textContent = p.context;
    question.textContent = p.question;

    buttons.innerHTML = '';
    p.buttons.forEach(b => {
      const btn = document.createElement('div');
      btn.className = 'perm-btn ' + b.class;
      btn.textContent = b.text;
      buttons.appendChild(btn);
    });
  }

  function renderWatch() {
    const connBar = document.getElementById('connBar');
    // Thinking/listening states override the connection bar color
    if (state.claudeState === 'thinking' || state.claudeState === 'listening') {
      connBar.className = 'conn-bar disconnected';
    } else {
      connBar.className = 'conn-bar ' + state.connection;
    }

    const badge = document.getElementById('stateBadge');
    badge.className = 'state-badge ' + state.claudeState;
    badge.textContent = state.claudeState === 'listening' ? 'recording' : state.claudeState;

    // Chat
    const chatArea = document.getElementById('chatArea');
    const emptyState = document.getElementById('emptyState');

    // Remove old messages
    chatArea.querySelectorAll('.chat-msg, .thinking-indicator').forEach(el => el.remove());

    if (state.messages.length === 0) {
      emptyState.style.display = 'flex';
    } else {
      emptyState.style.display = 'none';
      state.messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = 'chat-msg ' + msg.role;
        const label = document.createElement('div');
        label.className = 'msg-label';
        label.textContent = msg.role === 'user' ? 'You' : 'Claude';
        div.appendChild(label);
        const text = document.createElement('div');
        text.textContent = msg.text;
        div.appendChild(text);
        chatArea.appendChild(div);
      });

      // Thinking indicator
      if (state.claudeState === 'thinking') {
        const dots = document.createElement('div');
        dots.className = 'chat-msg claude thinking-indicator';
        dots.innerHTML = '<div class="thinking-dots"><span></span><span></span><span></span></div>';
        chatArea.appendChild(dots);
      }

      // Scroll to bottom
      chatArea.scrollTop = chatArea.scrollHeight;
    }

    // Bottom controls
    const recBtn = document.getElementById('recBtn');
    const abortBtn = document.getElementById('abortBtn');
    const audioCtrl = document.getElementById('audioCtrl');
    const progressOverlay = document.getElementById('progressOverlay');

    recBtn.style.display = 'none';
    abortBtn.classList.remove('visible');
    audioCtrl.classList.remove('visible');
    progressOverlay.classList.remove('visible');

    switch(state.claudeState) {
      case 'idle':
        recBtn.style.display = 'flex';
        recBtn.className = 'rec-btn idle';
        recBtn.textContent = 'Rec';
        break;
      case 'listening':
        recBtn.style.display = 'flex';
        recBtn.className = 'rec-btn recording';
        recBtn.textContent = 'Stop';
        break;
      case 'thinking':
        abortBtn.classList.add('visible');
        progressOverlay.classList.add('visible');
        break;
      case 'speaking':
        audioCtrl.classList.add('visible');
        break;
    }

    // Permission overlay
    const permOverlay = document.getElementById('permOverlay');
    if (state.permissionVisible) {
      permOverlay.classList.add('visible');
      renderPermission();
    } else {
      permOverlay.classList.remove('visible');
    }
  }

  function renderPermission() {
    const title = document.getElementById('permTitle');
    const context = document.getElementById('permContext');
    const question = document.getElementById('permQuestion');
    const buttons = document.getElementById('permButtons');

    const perms = {
      bash: {
        title: 'Permission',
        context: 'Tool: Bash',
        question: 'rm -rf /tmp/cache/*.tmp',
        buttons: [
          { text: 'Allow', class: 'allow' },
          { text: 'Allow Always', class: 'always' },
          { text: 'Deny', class: 'deny' }
        ]
      },
      write: {
        title: 'Permission',
        context: 'Tool: Write',
        question: 'Create file: src/health.py',
        buttons: [
          { text: 'Allow', class: 'allow' },
          { text: 'Deny', class: 'deny' }
        ]
      },
      edit: {
        title: 'Permission',
        context: 'Tool: Edit',
        question: 'Edit server.py lines 42-58',
        buttons: [
          { text: 'Allow', class: 'allow' },
          { text: 'Allow Always', class: 'always' },
          { text: 'Deny', class: 'deny' }
        ]
      }
    };

    const p = perms[state.permissionType] || perms.bash;
    title.textContent = p.title;
    context.textContent = p.context;
    question.textContent = p.question;

    buttons.innerHTML = '';
    p.buttons.forEach(b => {
      const btn = document.createElement('div');
      btn.className = 'perm-btn ' + b.class;
      btn.textContent = b.text;
      buttons.appendChild(btn);
    });
  }

  function updatePrompt() {
    const parts = ['Claude Watch mockup: round watch + companion phone side by side'];

    // State
    if (state.claudeState !== DEFAULTS.claudeState) {
      const labels = { listening: 'actively recording audio', thinking: 'processing with spinner + abort button', speaking: 'playing audio response with replay/pause controls' };
      parts.push(labels[state.claudeState] || state.claudeState + ' state');
    } else {
      parts.push('idle state with Record button');
    }

    // Connection
    if (state.connection !== DEFAULTS.connection) {
      parts.push(state.connection + ' (bar is ' + (state.connection === 'connecting' ? 'orange' : 'red') + ')');
    } else {
      parts.push('connected (green bar)');
    }

    // Messages
    if (state.messages.length > 0) {
      const userCount = state.messages.filter(m => m.role === 'user').length;
      const claudeCount = state.messages.filter(m => m.role === 'claude').length;
      parts.push(`${state.messages.length} chat messages (${userCount} user, ${claudeCount} Claude) in scrollable area`);
    } else {
      parts.push('empty chat with "Tap Record" placeholder');
    }

    // Permission
    if (state.permissionVisible) {
      const toolName = state.permissionType ? state.permissionType.charAt(0).toUpperCase() + state.permissionType.slice(1) : 'Bash';
      parts.push(`permission overlay for ${toolName} tool with Allow/Deny buttons on semi-transparent backdrop`);
    }

    document.getElementById('promptText').textContent = parts.join('. ') + '.';
  }

  function copyPrompt() {
    const text = document.getElementById('promptText').textContent;
    navigator.clipboard.writeText(text).then(() => {
      const btn = document.getElementById('copyBtn');
      btn.textContent = 'Copied!';
      setTimeout(() => btn.textContent = 'Copy', 1500);
    });
  }

  // Init
  updateAll();
</script>
</body>
</html>
